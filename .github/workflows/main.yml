name: DÃ©ploiement Statique Next.js via SFTP

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  build_and_deploy:
    runs-on: ubuntu-latest

    steps:
      # Checkout
      - name: VÃ©rifier le code source
        uses: actions/checkout@v4

      # Node.js
      - name: Configuration Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      # pnpm
      - name: Setup pnpm
        uses: pnpm/action-setup@v3
        with:
          version: 8
          run_install: false

      # Install
      - name: Installer les dÃ©pendances
        run: npm ci

      # Build Next.js
      - name: Build Next.js
        run: npm run build
        env:
          NODE_ENV: production

      # ðŸŸ¢ DÃ©ploiement SFTP
      - name: DÃ©ploiement via SFTP
        uses: easingthemes/ssh-deploy@v5.0.3
        with:
          server: 173.209.32.66
          username: cpupm452
          password: BzuN#)92Ze9W4s   # ou use_private_key: true
          port: 27

          # Dossier local : Next.js exporte dans ./out/
          local_path: "./out/"
          
          # Dossier distant (ex: /home/xxxx/public_html/)
          remote_path: ./

          # Nettoie les anciens fichiers avant upload
          clean: true
